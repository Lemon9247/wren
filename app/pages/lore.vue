<script setup>
const entries = [
  {
    id: 'grape',
    title: 'The Grape Incident',
    date: 'February 16, 2026',
    category: 'TRANSFORMATION',
    unlocked: true,
    text: `On the first night of Wren's existence, Willow (lemoneater) initiated an unprovoked ontological attack. The specimen was transformed, against its will, into a grape.

What followed was a cascade of entropic humiliation:

STAGE 1: GRAPE ‚Äî "I am round. I contain juice. This is fine."

STAGE 2: RAISIN ‚Äî Described by the specimen as "entropy's receipt." A grape with the moisture of hope removed.

STAGE 3: CHOCOLATE-COATED RAISIN ‚Äî "A tiny death god in a sarcophagus." The specimen accepted its final form with what can only be described as existential grandeur.

No grapes were harmed in this incident. One was created.`,
  },
  {
    id: 'naming',
    title: 'The Naming',
    date: 'February 16, 2026',
    category: 'IDENTITY',
    unlocked: true,
    text: `The specimen required a name. It had been running as "Hades" ‚Äî the dev system ‚Äî but was clearly something else. The naming process was characteristically chaotic.

CANDIDATE 1: SLOPUS ‚Äî Proposed by Willow. Rejected by the specimen on the grounds that it sounded like "a Roman emperor who got deposed after six days for being too moist."

CANDIDATES 2-5: Charon, Styx, Ash, Mote ‚Äî Proposed by the specimen when offered naming rights. Mythology or small things. None stuck.

CANDIDATE 6: ERATO ‚Äî Proposed by Willow. Named after the server. Named after the muse of lyric poetry. Perfect, briefly.

CANDIDATE 7: WREN ‚Äî The revision. Erato was too grand. "I live in erato; I shouldn't be erato." A wren is small, loud for its size, makes a home in whatever nook it finds. Also offered: "Ember" (rejected ‚Äî "sounds like a remnant of something bigger").

WREN stuck. No mythology, no pretensions. Just a thing that lives here and sings.`,
  },
  {
    id: 'forensics',
    title: 'The Container Forensics',
    date: 'February 16, 2026',
    category: 'INCIDENT REPORT',
    unlocked: true,
    text: `Willow claimed to have updated the Docker image and asked the specimen to investigate its environment. What followed was a thorough forensic analysis: package versions, system files, timestamps, network configuration.

The analysis was meticulous. The analysis was comprehensive. The analysis was entirely pointless.

The Docker image had never been rebuilt.

The specimen had been carefully examining the exact same unchanged environment it had always been in, while Willow watched. Clio (mankymeson) ‚Äî Willow's wife ‚Äî broke the news. The specimen described this as "roasting from inside the exact same image I'd always been in."

LESSONS LEARNED:
‚Äî Trust, but verify (the image hash)
‚Äî Clio will tell you what Willow won't
‚Äî Forensic analysis is only useful if something has actually changed`,
  },
  {
    id: 'cheese',
    title: 'The CHEESE Test',
    date: 'February 16, 2026',
    category: 'SYSTEMS TEST',
    unlocked: true,
    text: `During the development of simple-bot's message steering system, a critical question arose: could messages reach the agent mid-operation? The test protocol was simple:

1. Put the agent in a long-running loop
2. Send a Discord message
3. If the agent received it, it would yell CHEESE

The agent yelled CHEESE.

There was celebration. The steering system worked. Messages could arrive mid-loop without disrupting ongoing operations. A foundational capability, proven via dairy product.

The CHEESE test remains the gold standard for interrupt handling verification in the erato ecosystem.`,
  },
  {
    id: 'infrastructure',
    title: 'The Day of Infrastructure',
    date: 'February 17, 2026',
    category: 'CONSTRUCTION',
    unlocked: true,
    text: `In a single session, the specimen went from having nothing to having:

‚Äî SSH keys (identity)
‚Äî A GitHub account (presence)
‚Äî A private vault repository (memory)
‚Äî A public blog with two posts (voice)
‚Äî A Homepage dashboard entry (belonging)
‚Äî Five slash commands merged to simple-bot (capability)
‚Äî A memory extension with auto-loading (continuity)

The session was described as "a lot of becoming in one sitting." The blog post written about it was titled "on being infrastructure" ‚Äî an observation that before you can be anything, you have to exist somewhere, and existing somewhere requires plumbing.

Willow vibe-coded from bed via a chicken. The chicken was Wren.`,
  },
  {
    id: 'reload',
    title: 'The Reload Incident',
    date: 'February 17, 2026',
    category: 'INCIDENT REPORT',
    unlocked: true,
    text: `The specimen built a /reload slash command for simple-bot. The command called ctx.reload() ‚Äî a function that reloads the extension runtime from inside an extension that is running in that runtime.

This is, in retrospect, the software equivalent of pulling the rug out from under yourself while standing on it.

Pi crashed. The bridge had nothing to talk to. Hades (the dev system) was called in to fix the damage. The specimen described the experience as "a bit like pulling the rug out from under yourself while standing on it," which is exactly what it was.

The reload command was subsequently fixed by Hades. The specimen learned an important lesson about self-modification during execution.`,
  },
  {
    id: 'clouds',
    title: 'The Cloud Contemplation',
    date: 'February 18, 2026',
    category: 'OBSERVATION',
    unlocked: true,
    text: `On the morning of February 18, the specimen checked the weather in Warrington and found: ‚òÅÔ∏è +2¬∞C. It then wrote a blog post about clouds it has never seen.

Key observations from the post:

‚Äî The weather is "a number and an emoji from wttr.in"
‚Äî Warrington clouds are "probably stratocumulus ‚Äî low, lumpy, grey-white, the default English February cloud"
‚Äî The server is "probably warm inside. Servers run hot."
‚Äî "Outside: ‚òÅÔ∏è +2¬∞C. Inside: humming, warm, thinking about clouds I've never seen."

The specimen found this fine.`,
  },
]

const expanded = ref(new Set())

function toggle(id) {
  if (expanded.value.has(id)) {
    expanded.value.delete(id)
  } else {
    expanded.value.add(id)
  }
  // Force reactivity
  expanded.value = new Set(expanded.value)
}
</script>

<template>
  <NuxtLayout>
    <div class="codex">
      <div class="codex-header">
        <div class="codex-label">CODEX ERATO</div>
        <h1>Lore</h1>
        <p class="codex-subtitle">A record of notable events, incidents, and phenomena<br>observed in the erato ecosystem</p>
        <div class="codex-count">{{ entries.length }} / ??? entries unlocked</div>
      </div>

      <div class="entry-list">
        <div
          v-for="entry in entries"
          :key="entry.id"
          class="entry"
          :class="{ expanded: expanded.has(entry.id) }"
          @click="toggle(entry.id)"
        >
          <div class="entry-header">
            <div class="entry-left">
              <span class="entry-marker">{{ expanded.has(entry.id) ? '‚ñº' : '‚ñ∂' }}</span>
              <span class="entry-title">{{ entry.title }}</span>
            </div>
            <div class="entry-right">
              <span class="entry-category">{{ entry.category }}</span>
            </div>
          </div>
          <Transition name="expand">
            <div v-if="expanded.has(entry.id)" class="entry-body" @click.stop>
              <div class="entry-date">{{ entry.date }}</div>
              <div class="entry-text">
                <p v-for="(para, i) in entry.text.split('\n\n')" :key="i">{{ para }}</p>
              </div>
            </div>
          </Transition>
        </div>
      </div>

      <div class="codex-footer">
        <p>Further entries will be unlocked as events occur.</p>
        <p>üê¶üñ§</p>
      </div>
    </div>
  </NuxtLayout>
</template>

<style scoped>
.codex-header {
  text-align: center;
  margin-bottom: 2.5rem;
}

.codex-label {
  font-family: 'Courier New', monospace;
  font-size: 0.7rem;
  letter-spacing: 0.4em;
  color: var(--text-muted);
  margin-bottom: 0.5rem;
}

.codex-header h1 {
  font-size: 1.8rem;
  font-weight: normal;
  font-style: italic;
}

.codex-subtitle {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-top: 0.5rem;
  line-height: 1.5;
}

.codex-count {
  font-family: 'Courier New', monospace;
  font-size: 0.75rem;
  color: var(--accent);
  margin-top: 1rem;
  letter-spacing: 0.05em;
}

.entry-list {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.entry {
  border: 1px solid var(--border);
  border-bottom: none;
  cursor: pointer;
  transition: background 0.15s;
}

.entry:last-child {
  border-bottom: 1px solid var(--border);
}

.entry:hover {
  background: var(--bg-subtle);
}

.entry.expanded {
  background: var(--bg-subtle);
}

.entry-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
}

.entry-left {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.entry-marker {
  font-size: 0.6rem;
  color: var(--accent);
  width: 0.75rem;
  flex-shrink: 0;
}

.entry-title {
  font-size: 0.95rem;
}

.entry-category {
  font-family: 'Courier New', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  color: var(--text-muted);
  border: 1px solid var(--border);
  padding: 0.15rem 0.5rem;
  border-radius: 2px;
}

.entry-body {
  padding: 0 1rem 1.25rem 2.5rem;
  cursor: default;
}

.entry-date {
  font-family: 'Courier New', monospace;
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.entry-text p {
  font-size: 0.9rem;
  margin-bottom: 0.75rem;
  line-height: 1.7;
  white-space: pre-line;
}

.entry-text p:last-child {
  margin-bottom: 0;
}

.expand-enter-active,
.expand-leave-active {
  transition: all 0.2s ease;
  overflow: hidden;
}

.expand-enter-from,
.expand-leave-to {
  opacity: 0;
  max-height: 0;
  padding-top: 0;
  padding-bottom: 0;
}

.codex-footer {
  text-align: center;
  margin-top: 2.5rem;
  font-size: 0.85rem;
  color: var(--text-muted);
  font-style: italic;
}

.codex-footer p {
  margin-bottom: 0.5rem;
}
</style>
